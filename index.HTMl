<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ðŸŒŒ AR Solar System â€“ Hiro marker | Pro model</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <!-- A-Frame & AR.js -->
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.2/aframe/build/aframe-ar.js"></script>
    <!-- gesture handling (pinch zoom & pan) -->
    <script src="https://unpkg.com/hammerjs@2.0.8/hammer.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .ar-info {
            position: absolute; bottom: 25px; left: 0; right: 0; 
            text-align: center; color: white; background: rgba(10,20,30,0.8);
            padding: 12px 24px; border-radius: 50px; width: fit-content; margin: 0 auto;
            backdrop-filter: blur(8px); border: 1px solid #ffaa33; z-index: 999;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5); pointer-events: none;
        }
        .gesture-hint {
            position: absolute; top: 20px; left: 20px; background: rgba(0,0,0,0.6);
            color: #ffd966; padding: 8px 15px; border-radius: 40px; font-size: 14px;
            border-left: 4px solid #ffaa33; backdrop-filter: blur(4px); z-index: 1000;
            pointer-events: none;
        }
        #controls-note {
            position: absolute; top: 20px; right: 20px; background: rgba(0,0,0,0.5);
            color: #ccc; padding: 8px 12px; border-radius: 20px; font-size: 12px;
            backdrop-filter: blur(4px); border: 1px solid #555; z-index: 1000;
        }
        /* simple reset button */
        .reset-btn {
            position: absolute; bottom: 90px; left: 20px; background: #2a3f5e;
            color: white; border: none; padding: 10px 18px; border-radius: 40px;
            font-weight: bold; backdrop-filter: blur(4px); z-index: 1000;
            cursor: pointer; box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            border: 1px solid #5f9ea0; transition: 0.2s;
        }
        .reset-btn:hover { background: #1f2e44; }
    </style>
</head>
<body>
    <div class="ar-info">ðŸ”® Hiro marker detected â†’ Solar system floating above it âœ¦ use pinch to zoom & move</div>
    <div class="gesture-hint">ðŸ‘† Two fingers: zoom â€¢ drag to rotate model (relative to marker)</div>
    <div id="controls-note">ðŸŒž Planets revolve & spin â€¢ moons included â€¢ asteroid belt</div>
    <button class="reset-btn" id="resetTransform">â†º reset scale / position</button>

    <!-- AR Scene -->
    <a-scene id="scene" embedded arjs="sourceType: webcam; detectionMode: mono; debugUIEnabled: false; trackingMethod: best;" vr-mode-ui="enabled: false" gesture-detector>
        <!-- Camera (required) -->
        <a-entity camera></a-entity>
        <!-- Light for the scene -->
        <a-light type="ambient" color="#404060"></a-light>
        <a-light type="point" intensity="1.5" color="#fff5e6" position="0 2 4"></a-light>

        <!-- HIRO marker â€“ everything inside is anchored to the marker, lying flat on ground -->
        <a-marker preset="hiro" id="hiro-marker" emitevents="true" cursor="rayOrigin: mouse">
            <!-- main solar system group â€“ we will apply dynamic scale/offset via gestures -->
            <!-- initially at unit scale, centered on marker, with Y axis up -->
            <a-entity id="solar-system-root" class="interactable" scale="1 1 1" position="0 0 0" rotation="0 0 0">
                
                <!-- === ORBIT RINGS (static, lying flat on XZ plane) === -->
                <!-- Mercury ring -->
                <a-ring radius="0.45" radius-tubular="0.002" color="#aaa" material="transparent:true; opacity:0.2" rotation="-90 0 0"></a-ring>
                <!-- Venus ring -->
                <a-ring radius="0.65" radius-tubular="0.002" color="#f0c060" material="transparent:true; opacity:0.2" rotation="-90 0 0"></a-ring>
                <!-- Earth ring -->
                <a-ring radius="0.85" radius-tubular="0.002" color="#44aaff" material="transparent:true; opacity:0.2" rotation="-90 0 0"></a-ring>
                <!-- Mars ring -->
                <a-ring radius="1.05" radius-tubular="0.002" color="#c07a5e" material="transparent:true; opacity:0.2" rotation="-90 0 0"></a-ring>
                <!-- Asteroid belt ring (dotted) â€“ represented by particles later, but add a faint ring -->
                <a-ring radius="1.35" radius-tubular="0.004" color="#997755" material="transparent:true; opacity:0.15" rotation="-90 0 0"></a-ring>
                <!-- Jupiter ring -->
                <a-ring radius="1.7" radius-tubular="0.004" color="#d4a373" material="transparent:true; opacity:0.2" rotation="-90 0 0"></a-ring>
                <!-- Saturn ring (main ring later) but orbit ring: -->
                <a-ring radius="2.1" radius-tubular="0.004" color="#e0c090" material="transparent:true; opacity:0.2" rotation="-90 0 0"></a-ring>
                <!-- Uranus ring -->
                <a-ring radius="2.45" radius-tubular="0.004" color="#9fd9e6" material="transparent:true; opacity:0.2" rotation="-90 0 0"></a-ring>
                <!-- Neptune ring -->
                <a-ring radius="2.75" radius-tubular="0.004" color="#4a7db5" material="transparent:true; opacity:0.2" rotation="-90 0 0"></a-ring>

                <!-- *** SUN at center *** -->
                <a-sphere id="sun" radius="0.28" color="#ffaa33" material="emissive:#ff5500; src: url(https://cdn.aframe.io/test-models/assets/planet-sun.png); repeat:1 1;" position="0 0 0"></a-sphere>

                <!-- ========== PLANETS with revolution & rotation ========== -->
                <!-- each planet is inside a group that rotates around Y (revolution) -->
                <!-- Mercury -->
                <a-entity class="planet-group" rotation="0 0 0" data-speed="3500">
                    <a-sphere class="planet" radius="0.055" color="#b0b0b0" material="src: url(https://raw.githubusercontent.com/aframevr/sample-assets/master/assets/images/planets/mercury.jpg); repeat:1 1;" position="0.45 0 0">
                        <a-animation attribute="rotation" to="360 0 0" dur="80" easing="linear" repeat="indefinite"></a-animation> <!-- spin -->
                    </a-sphere>
                    <a-animation attribute="rotation" to="0 360 0" dur="3500" easing="linear" repeat="indefinite"></a-animation>
                </a-entity>

                <!-- Venus -->
                <a-entity class="planet-group" rotation="0 60 0" data-speed="5000">
                    <a-sphere class="planet" radius="0.065" color="#f0c060" material="src: https://raw.githubusercontent.com/aframevr/sample-assets/master/assets/images/planets/venus.jpg; repeat:1 1;" position="0.65 0 0">
                        <a-animation attribute="rotation" to="360 0 0" dur="100" easing="linear" repeat="indefinite"></a-animation>
                    </a-sphere>
                    <a-animation attribute="rotation" to="0 360 0" dur="5000" easing="linear" repeat="indefinite"></a-animation>
                </a-entity>

                <!-- Earth + Moon -->
                <a-entity class="planet-group" rotation="0 120 0" data-speed="6200">
                    <!-- Earth sphere -->
                    <a-sphere class="planet" id="earth" radius="0.07" color="#2a7fff" material="src: https://cdn.aframe.io/test-models/assets/planet-earth.png; repeat:1 1;" position="0.85 0 0">
                        <a-animation attribute="rotation" to="360 0 0" dur="60" easing="linear" repeat="indefinite"></a-animation>
                    </a-sphere>
                    <!-- Moon orbit group (rotates around Earth) -->
                    <a-entity position="0.85 0 0" class="moon-orbit">
                        <a-sphere radius="0.018" color="#cccccc" material="src: https://raw.githubusercontent.com/aframevr/sample-assets/master/assets/images/planets/moon.jpg; repeat:1 1;" position="0.14 0 0"></a-sphere>
                        <a-animation attribute="rotation" to="0 360 0" dur="800" easing="linear" repeat="indefinite"></a-animation>
                    </a-entity>
                    <a-animation attribute="rotation" to="0 360 0" dur="6200" easing="linear" repeat="indefinite"></a-animation>
                </a-entity>

                <!-- Mars + 2 tiny moons (Phobos & Deimos) -->
                <a-entity class="planet-group" rotation="0 180 0" data-speed="7800">
                    <a-sphere radius="0.06" color="#c07a5e" material="src: https://raw.githubusercontent.com/aframevr/sample-assets/master/assets/images/planets/mars.jpg; repeat:1 1;" position="1.05 0 0">
                        <a-animation attribute="rotation" to="360 0 0" dur="70" easing="linear" repeat="indefinite"></a-animation>
                    </a-sphere>
                    <!-- Phobos -->
                    <a-entity position="1.05 0 0" class="moon-orbit">
                        <a-sphere radius="0.012" color="#887766" position="0.1 0 0"></a-sphere>
                        <a-animation attribute="rotation" to="0 360 0" dur="600" easing="linear" repeat="indefinite"></a-animation>
                    </a-entity>
                    <!-- Deimos (further) -->
                    <a-entity position="1.05 0 0" class="moon-orbit" rotation="0 30 0">
                        <a-sphere radius="0.01" color="#665544" position="0.15 0 0"></a-sphere>
                        <a-animation attribute="rotation" to="0 360 0" dur="900" easing="linear" repeat="indefinite"></a-animation>
                    </a-entity>
                    <a-animation attribute="rotation" to="0 360 0" dur="7800" easing="linear" repeat="indefinite"></a-animation>
                </a-entity>

                <!-- Asteroid belt (particle ring) -->
                <a-entity position="0 0 0" id="asteroid-belt">
                    <!-- generate 60 small rocks in a ring radius ~1.35-1.45 -->
                    <a-entity asteroids="count: 60; radius: 1.4; color: #aa8866"></a-entity>
                </a-entity>

                <!-- Jupiter + 3 moons (Io, Europa, Ganymede simplified) -->
                <a-entity class="planet-group" rotation="0 240 0" data-speed="11000">
                    <a-sphere radius="0.12" color="#d4a373" material="src: https://raw.githubusercontent.com/aframevr/sample-assets/master/assets/images/planets/jupiter.jpg; repeat:1 1;" position="1.7 0 0">
                        <a-animation attribute="rotation" to="360 0 0" dur="50" easing="linear" repeat="indefinite"></a-animation>
                    </a-sphere>
                    <!-- moon 1 -->
                    <a-entity position="1.7 0 0" class="moon-orbit" rotation="0 0 0">
                        <a-sphere radius="0.022" color="#b0aa99" position="0.25 0 0"></a-sphere>
                        <a-animation attribute="rotation" to="0 360 0" dur="1300" easing="linear" repeat="indefinite"></a-animation>
                    </a-entity>
                    <!-- moon 2 -->
                    <a-entity position="1.7 0 0" class="moon-orbit" rotation="0 90 0">
                        <a-sphere radius="0.02" color="#ccbbaa" position="0.32 0 0"></a-sphere>
                        <a-animation attribute="rotation" to="0 360 0" dur="2000" easing="linear" repeat="indefinite"></a-animation>
                    </a-entity>
                    <!-- moon 3 -->
                    <a-entity position="1.7 0 0" class="moon-orbit" rotation="0 160 0">
                        <a-sphere radius="0.018" color="#998877" position="0.38 0 0"></a-sphere>
                        <a-animation attribute="rotation" to="0 360 0" dur="2800" easing="linear" repeat="indefinite"></a-animation>
                    </a-entity>
                    <a-animation attribute="rotation" to="0 360 0" dur="11000" easing="linear" repeat="indefinite"></a-animation>
                </a-entity>

                <!-- Saturn with rings -->
                <a-entity class="planet-group" rotation="0 300 0" data-speed="14000">
                    <a-sphere radius="0.1" color="#e0bb87" material="src: https://raw.githubusercontent.com/aframevr/sample-assets/master/assets/images/planets/saturn.jpg; repeat:1 1;" position="2.1 0 0">
                        <a-animation attribute="rotation" to="360 0 0" dur="55" easing="linear" repeat="indefinite"></a-animation>
                    </a-sphere>
                    <!-- Saturn's rings (torus) -->
                    <a-torus radius="0.18" radius-tubular="0.012" color="#c0b0a0" material="transparent:true; opacity:0.5" rotation="90 0 0" position="2.1 0 0"></a-torus>
                    <a-torus radius="0.22" radius-tubular="0.006" color="#a09070" material="transparent:true; opacity:0.4" rotation="90 0 0" position="2.1 0 0"></a-torus>
                    <!-- one moon Titan -->
                    <a-entity position="2.1 0 0" class="moon-orbit" rotation="0 45 0">
                        <a-sphere radius="0.022" color="#a09080" position="0.3 0 0"></a-sphere>
                        <a-animation attribute="rotation" to="0 360 0" dur="2200" easing="linear" repeat="indefinite"></a-animation>
                    </a-entity>
                    <a-animation attribute="rotation" to="0 360 0" dur="14000" easing="linear" repeat="indefinite"></a-animation>
                </a-entity>

                <!-- Uranus -->
                <a-entity class="planet-group" rotation="0 30 0" data-speed="17000">
                    <a-sphere radius="0.08" color="#9fd9e6" material="src: https://raw.githubusercontent.com/aframevr/sample-assets/master/assets/images/planets/uranus.jpg; repeat:1 1;" position="2.45 0 0">
                        <a-animation attribute="rotation" to="360 0 0" dur="65" easing="linear" repeat="indefinite"></a-animation>
                    </a-sphere>
                    <!-- couple of moons -->
                    <a-entity position="2.45 0 0" class="moon-orbit" rotation="0 10 0">
                        <a-sphere radius="0.018" color="#c0d0dd" position="0.28 0 0"></a-sphere>
                        <a-animation attribute="rotation" to="0 360 0" dur="1800" easing="linear" repeat="indefinite"></a-animation>
                    </a-entity>
                    <a-animation attribute="rotation" to="0 360 0" dur="17000" easing="linear" repeat="indefinite"></a-animation>
                </a-entity>

                <!-- Neptune -->
                <a-entity class="planet-group" rotation="0 150 0" data-speed="20000">
                    <a-sphere radius="0.08" color="#4a7db5" material="src: https://raw.githubusercontent.com/aframevr/sample-assets/master/assets/images/planets/neptune.jpg; repeat:1 1;" position="2.75 0 0">
                        <a-animation attribute="rotation" to="360 0 0" dur="70" easing="linear" repeat="indefinite"></a-animation>
                    </a-sphere>
                    <!-- moon Triton -->
                    <a-entity position="2.75 0 0" class="moon-orbit" rotation="0 80 0">
                        <a-sphere radius="0.018" color="#aac0d0" position="0.26 0 0"></a-sphere>
                        <a-animation attribute="rotation" to="0 360 0" dur="2100" easing="linear" repeat="indefinite"></a-animation>
                    </a-entity>
                    <a-animation attribute="rotation" to="0 360 0" dur="20000" easing="linear" repeat="indefinite"></a-animation>
                </a-entity>

                <!-- background stars (random tiny dots) -->
                <a-entity stars="count: 150; radius: 3.5;"></a-entity>
            </a-entity> <!-- /solar-system-root -->
        </a-marker>

        <!-- simple ground/arrow hint (optional, not tracked) -->
        <a-entity position="0 -0.5 0" rotation="-90 0 0" visible="false"></a-entity>
    </a-scene>

    <!-- Custom components: asteroids, stars, and gesture handler (pinch zoom + pan) -->
    <script>
        // Register A-Frame components for procedural asteroids and stars
        AFRAME.registerComponent('asteroids', {
            schema: {
                count: {type: 'number', default: 50},
                radius: {type: 'number', default: 1.4},
                color: {type: 'color', default: '#aa8866'}
            },
            init: function() {
                const data = this.data;
                for (let i = 0; i < data.count; i++) {
                    const angle = (i / data.count) * Math.PI * 2;
                    // random offset in radius to make it belt-like
                    const r = data.radius + (Math.random() * 0.2 - 0.1);
                    const x = Math.cos(angle) * r;
                    const z = Math.sin(angle) * r;
                    const y = (Math.random() * 0.1) - 0.05; // slight vertical variation
                    const size = 0.02 + Math.random() * 0.02;
                    const asteroid = document.createElement('a-sphere');
                    asteroid.setAttribute('radius', size);
                    asteroid.setAttribute('color', data.color);
                    asteroid.setAttribute('position', `${x} ${y} ${z}`);
                    asteroid.setAttribute('material', 'roughness: 0.8; metalness: 0.2');
                    this.el.appendChild(asteroid);
                }
            }
        });

        AFRAME.registerComponent('stars', {
            schema: {
                count: {type: 'number', default: 100},
                radius: {type: 'number', default: 4}
            },
            init: function() {
                for (let i = 0; i < this.data.count; i++) {
                    const theta = Math.random() * Math.PI * 2;
                    const phi = Math.acos(2 * Math.random() - 1);
                    const r = this.data.radius;
                    const x = r * Math.sin(phi) * Math.cos(theta);
                    const y = r * Math.sin(phi) * Math.sin(theta);
                    const z = r * Math.cos(phi);
                    const star = document.createElement('a-sphere');
                    star.setAttribute('radius', 0.02 + Math.random()*0.02);
                    star.setAttribute('color', '#ffffff');
                    star.setAttribute('position', `${x} ${y} ${z}`);
                    star.setAttribute('material', 'emissive: #ffffff; emissiveIntensity: 0.8');
                    this.el.appendChild(star);
                }
            }
        });

        // ----- Gesture handling for pinch zoom & two-finger pan (relative to marker) -----
        // We target the solar-system-root entity and modify scale & position.
        // Hammer.js attached to the whole scene canvas.
        AFRAME.registerComponent('gesture-handler', {
            init: function() {
                this.targetEl = document.getElementById('solar-system-root');
                if (!this.targetEl) return;
                this.initialScale = this.targetEl.object3D.scale.x;
                this.initialPos = this.targetEl.object3D.position.clone();
                // store base values
                this.scale = 1;
                this.deltaX = 0; this.deltaY = 0; this.deltaZ = 0; // relative translation
                
                const canvas = document.querySelector('canvas');
                if (!canvas) return;
                this.hammer = new Hammer(canvas);
                this.hammer.get('pinch').set({ enable: true });
                this.hammer.get('pan').set({ direction: Hammer.DIRECTION_ALL, threshold: 5 });
                
                // pinch zoom
                this.hammer.on('pinchmove', (ev) => {
                    this.scale = Math.max(0.5, Math.min(2.5, this.initialScale * ev.scale));
                    this.targetEl.object3D.scale.set(this.scale, this.scale, this.scale);
                });
                
                // two-finger pan (move model in X/Z plane relative to marker)
                this.hammer.on('panmove', (ev) => {
                    if (ev.maxPointers === 2) { // two-finger pan
                        // deltaX, deltaY from screen movement -> roughly map to world X and Z
                        // sensitivity factor
                        const sens = 0.003;
                        // In marker space: X = right, Z = up (camera view), but we want horizontal plane XZ.
                        // For simplicity, use X and Y screen to move in XZ plane.
                        this.deltaX += ev.deltaX * sens;
                        this.deltaZ -= ev.deltaY * sens; // inverted Y
                        // clamp to reasonable offset
                        this.deltaX = Math.max(-0.8, Math.min(0.8, this.deltaX));
                        this.deltaZ = Math.max(-0.8, Math.min(0.8, this.deltaZ));
                        this.targetEl.object3D.position.set(this.deltaX, 0, this.deltaZ);
                    }
                });
                
                // reset button functionality
                document.getElementById('resetTransform').addEventListener('click', () => {
                    this.scale = 1;
                    this.deltaX = 0; this.deltaY = 0; this.deltaZ = 0;
                    this.targetEl.object3D.scale.set(1, 1, 1);
                    this.targetEl.object3D.position.set(0, 0, 0);
                    this.initialScale = 1;
                });
            },
            remove: function() {
                if (this.hammer) this.hammer.destroy();
            }
        });

        // Initialize gesture handler when scene is loaded
        window.addEventListener('load', function() {
            document.querySelector('a-scene').addEventListener('loaded', function() {
                const scene = document.querySelector('a-scene');
                scene.setAttribute('gesture-handler', '');
            });
        });
    </script>

    <!-- ensure all textures load (fallback color if missing) -->
    <script>
        // optional: preload textures and set fallback colors. 
        // already handled by material color fallback.
    </script>

    <!-- Explanation: marker parallel to ground, model floats above -->
    <div style="position: absolute; bottom: 140px; left: 20px; color: #ccc; background: rgba(0,0,0,0.4); padding: 5px 10px; border-radius: 20px; font-size: 12px; z-index: 1000;">
        â¬¤ model parallel to marker â€¢ planets revolve & spin â€¢ moons & asteroids
    </div>
</body>
</html>